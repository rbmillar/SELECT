Target
f=function(eps) compute_coverage(eps)-coverage
Target=uniroot(f,lower=0,upper=0.025,tol=0.0001)
save.BootPreds=BootPreds
BootPreds=BootPreds[1:100,]
Target=uniroot(f,lower=0,upper=0.025,tol=0.0001)
Target
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(1,40))
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(1,40))
Target=uniroot(f,lower=0,upper=0.025,tol=1e-6)
Target
Target=uniroot(f,lower=0,upper=0.025,tol=1e-6)$f.root
BootPreds=save.BootPreds
Target=uniroot(f,lower=0,upper=0.025,tol=1e-6)$f.root
Target
uniroot(f,lower=0,upper=0.025,tol=1e-6)
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(1,40))
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(10,20))
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(1,40))
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(10,20))
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(7.5,22.5))
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(10,20))
Target
?uniroot
Target=uniroot(f,lower=0,upper=0.025,tol=1e-6)
Target
X=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(10,20))
X$plot
X=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show=T,limits=c(15,15)
)
X$plot
X
remotes::install_github("rbmillar/SELECT")
#remotes::install_github("rbmillar/SELECT")
require(tidyverse)
require(mgcv)
require(SELECT)
require(readxl) #This package is installed with tidyverse
nsim=1000 #For bootstrapping and permutation tests, set to >=999 in practice
GearA.df=read_excel("SchoolPrawnLenFreqs.xlsx", sheet = "32 square trawl")
GearB.df=read_excel("SchoolPrawnLenFreqs.xlsx", sheet = "35 square trawl")
#The "Day" variable is actually the unique haul-pair identifier
GearA.df = GearA.df |> rename(Haul=Day, nA=No.school, sfA=Sf.school)
GearB.df = GearB.df |> rename(Haul=Day, nB=No.school, sfB=Sf.school)
#Merge the gears with the same identical haul-pair ID (i.e., twin tows)
Pairs.df = inner_join(GearA.df,GearB.df,by=c("Haul","CL"))
#Convert scaling factors to sampling fractions
Pairs.df = Pairs.df |>
transform(qA=1/sfA,qB=1/sfB) |> filter(CL>=5 & CL<=25)
#write.csv(Pairs.df,"Pairs.RData",row.names=F)
### Inspect the data
MLS=15 #Minimum legal size
cat("Number of haul pairs is",length(unique(Pairs.df$Haul)),"\n")
#NB: No need to correct for q, since q is same within gear
Catches.df=Pairs.df |> transform(nA=nA/qA,nB=nB/qB)
Catches.df |> group_by(CL) |> summarize(nA=sum(nA),nB=sum(nB))
Catches.df |> group_by(Haul) |>
summarize(PropnA=sum(nA[CL>=MLS])/sum(nA),
PropnB=sum(nB[CL>=MLS])/sum(nB),
Ratio=PropnB/PropnA, N=sum(nA+nB), Propn=sum(nB)/N)
#Overall ratio
Catches.df |>
summarize(PropnA=sum(nA[CL>=MLS])/sum(nA),
PropnB=sum(nB[CL>=MLS])/sum(nB),
Ratio=PropnB/PropnA,sumnA=sum(nA),sumnB=sum(nB))
names(Pairs.df)
vNames=c("CL","nA","nB")
qNames=c("qA","qB")
#Define the bootstrap prediction function
CLseq=seq(5,25,0.5) #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#Define the bootstrap prediction function
CLseq=seq(5,23,0.5) #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
dim(BootPreds)
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#The new plot function to replace BootPlot
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot
BootPlot2
devtools::install( paste0("T:/Russell_SSD/ACTIVE/CurrentWork/RPackages/",PkgName) )
PkgName="SELECT"
devtools::install( paste0("T:/Russell_SSD/ACTIVE/CurrentWork/RPackages/",PkgName) )
setwd("T:/Russell_SSD/ACTIVE/CurrentWork/RPackages/SELECT/CaseStudies/RelativeSeln_PairedHauls")
#remotes::install_github("rbmillar/SELECT")
require(tidyverse)
require(mgcv)
require(SELECT)
require(readxl) #This package is installed with tidyverse
nsim=1000 #For bootstrapping and permutation tests, set to >=999 in practice
knitr::opts_chunk$set(fig.height = 3.5)
#remotes::install_github("rbmillar/SELECT")
require(tidyverse)
require(mgcv)
require(SELECT)
require(readxl) #This package is installed with tidyverse
nsim=1000 #For bootstrapping and permutation tests, set to >=999 in practice
GearA.df=read_excel("SchoolPrawnLenFreqs.xlsx", sheet = "32 square trawl")
GearB.df=read_excel("SchoolPrawnLenFreqs.xlsx", sheet = "35 square trawl")
#The "Day" variable is actually the unique haul-pair identifier
GearA.df = GearA.df |> rename(Haul=Day, nA=No.school, sfA=Sf.school)
GearB.df = GearB.df |> rename(Haul=Day, nB=No.school, sfB=Sf.school)
#Merge the gears with the same identical haul-pair ID (i.e., twin tows)
Pairs.df = inner_join(GearA.df,GearB.df,by=c("Haul","CL"))
#Convert scaling factors to sampling fractions
Pairs.df = Pairs.df |>
transform(qA=1/sfA,qB=1/sfB) |> filter(CL>=5 & CL<=25)
#write.csv(Pairs.df,"Pairs.RData",row.names=F)
### Inspect the data
MLS=15 #Minimum legal size
cat("Number of haul pairs is",length(unique(Pairs.df$Haul)),"\n")
#NB: No need to correct for q, since q is same within gear
Catches.df=Pairs.df |> transform(nA=nA/qA,nB=nB/qB)
Catches.df |> group_by(CL) |> summarize(nA=sum(nA),nB=sum(nB))
Catches.df |> group_by(Haul) |>
summarize(PropnA=sum(nA[CL>=MLS])/sum(nA),
PropnB=sum(nB[CL>=MLS])/sum(nB),
Ratio=PropnB/PropnA, N=sum(nA+nB), Propn=sum(nB)/N)
#Overall ratio
Catches.df |>
summarize(PropnA=sum(nA[CL>=MLS])/sum(nA),
PropnB=sum(nB[CL>=MLS])/sum(nB),
Ratio=PropnB/PropnA,sumnA=sum(nA),sumnB=sum(nB))
names(Pairs.df)
vNames=c("CL","nA","nB")
qNames=c("qA","qB")
#Define the bootstrap prediction function
CLseq=seq(5,23,0.5) #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot$plot+geom_hline(yintercept=0.5,linetype="dashed")
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
x=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
x
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SimPlot
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
x=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
x
?attributes
x
y
y=3
?attr
attr(y,c("a","b"))=c("sadf",4)
y
attributes(y)=list(a=3,b="daf")
y
attr(y,"a")="dafsdf"
y
attr(y,"a")=c(a=3,b=9)
y
attr(y,"a")=list(a=3,b=9)
attr(y,"b")
attr(y,"b")=NULL
y
attributes(y)=NULL
y
attr(y,"a")=list(a=3,b=9)
y
attributes(y)=c(1,2)
attributes(y)=list(1:2)
attributes(y)=list(a=1,b=2)
y
attributes(y)=list(a=1:2)
y
attributes(y)=list(specs=c(a=1,b=2))
y
attributes(y)=list(specs=t(c(a=1,b=2)))
y
es
BootPlot2=function(BootPreds, lenseq, predn, Data=NULL, coverage=0.95, limits=NULL,
txt=8, xlab="Length (cm)", ylab="Catch proportion",
show.pointwise=FALSE) {
# Remove rows with NA values
valid.rows <- complete.cases(BootPreds)
BootPreds <- BootPreds[valid.rows, , drop=FALSE]
nsim <- nrow(BootPreds)
if(nsim < 99) warning("Few valid bootstrap replicates - intervals may be unreliable")
# Determine which columns (lengths) to use for coverage calculation
if(is.null(limits)) {
use_cols <- seq_along(lenseq)
} else {
use_cols <- which(lenseq >= limits[1] & lenseq <= limits[2])
if(length(use_cols) == 0) stop("No lengths fall within specified limits")
}
# Function to compute coverage for a given eps
# Coverage = proportion of bootstrap curves entirely within [lower, upper] bounds
compute_coverage <- function(eps) {
lower <- apply(BootPreds, 2, quantile, prob=eps, na.rm=TRUE)
upper <- apply(BootPreds, 2, quantile, prob=1-eps, na.rm=TRUE)
# Check each bootstrap curve: is it entirely within bounds (for selected columns)
within_bounds <- apply(BootPreds, 1, function(curve) {
all(curve[use_cols] >= lower[use_cols] & curve[use_cols] <= upper[use_cols])
})
mean(within_bounds)
}
init.coverage=compute_coverage( (1-coverage)/2 )
# Binary search to find eps that achieves desired coverage
# eps=0 gives 100% coverage, eps=(1-coverage)/2 is the pointwise eps
# It is nimbler to use uniroot (stats) to find eps but it doesn't find exact
# coverage sometimes, perhaps due to stepwise behaviour of compute_coverage?
#f=function(eps) compute_coverage(eps)-coverage
#Target=uniroot(f,lower=0,upper=0.025)
#eps_final=Target$root
#coverage_achieved=Target$f.root+coverage
eps_low <- 0
eps_high <- (1 - coverage) / 2
target <- coverage
tol <- 0.0001
# Binary search
max_iter <- 50
for(i in 1:max_iter) {
eps_mid <- (eps_low + eps_high) / 2
cov_mid <- compute_coverage(eps_mid)
if(abs(cov_mid - target) < tol) {
break
}
# Coverage increases as eps decreases (bounds get wider)
if(cov_mid < target) {
# Need wider bounds, decrease eps
eps_high <- eps_mid
} else {
# Bounds too wide, increase eps
eps_low <- eps_mid
}
}
eps_final <- eps_mid
coverage_achieved <- cov_mid
# Compute final bounds
Preds.lower <- apply(BootPreds, 2, quantile, prob=eps_final, na.rm=TRUE)
Preds.upper <- apply(BootPreds, 2, quantile, prob=1-eps_final, na.rm=TRUE)
Pdf <- data.frame(len=lenseq, pred=predn, low=Preds.lower, upp=Preds.upper)
# Build the plot
BootGROB <- ggplot(data=Pdf, aes(len)) +
geom_ribbon(data=Pdf[use_cols,],
aes(x=len, ymin=low, ymax=upp), alpha=0.2) +
geom_line(data=Pdf, aes(len, pred)) + ylim(0,1) +
xlab(xlab) + ylab(ylab) + theme_bw() +
theme(axis.text=element_text(size=txt), axis.title=element_text(size=txt)) +
theme(plot.margin = unit(c(0.75, 0.5, 0.25, 0.5), "cm"))
# Optionally add pointwise intervals as inner band
if(show.pointwise) {
pw_eps <- (1 - coverage) / 2
Preds.lower.pw <- apply(BootPreds, 2, quantile, prob=pw_eps, na.rm=TRUE)
Preds.upper.pw <- apply(BootPreds, 2, quantile, prob=1-pw_eps, na.rm=TRUE)
Pdf$low.pw <- Preds.lower.pw
Pdf$upp.pw <- Preds.upper.pw
BootGROB <- BootGROB +
geom_ribbon(data=Pdf, aes(x=len, ymin=low.pw, ymax=upp.pw), alpha=0.3)
}
if(!is.null(Data)) BootGROB <- BootGROB + geom_point(data=Data, aes(x=lgth, y=y))
cat("\n initial.pointwise.coverage:",coverage,
"\n initial.simultaneous.coverage:",init.coverage,
"\n adjusted.pointwise.coverage:",1-2*eps_final,
"\n adjusted.simultaneous.coverage:",coverage_achieved,"\n")
BootGROB
}
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
#Define the bootstrap prediction function
CLseq=5:23 #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
BootPlot(BootPreds,CLseq,predn,Data=Tots.df) +
geom_hline(yintercept=0.5,linetype="dashed")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
nsim=10000
BootPreds=bootSELECT(Pairs.df,vNames,qNames,PrednFnc,haul="Haul",nsim=nsim,
paired=T,verbose=T) #Use verbose=T to see progress
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
1-0.05/19
qnorm(0.9935)
qnorm(0.9975)
CLseq=8:20
BootPlot2
Tots.df
#Setting limits to include only lengths where >30 prawn caught
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,
limits=9:21,show.pointwise=T)
#Setting limits to include only lengths where >30 prawn caught
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,
limits=c(9,21),show.pointwise=T)
#Setting limits to include only lengths where >30 prawn caught
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,
limits=c(9,21),show.pointwise=T)
BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise = T,txt=12)
#Define the bootstrap prediction function
CLseq=5:23 #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
#Setting limits to include only lengths where >30 prawn caught
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,
limits=c(9,21),show.pointwise=T)
SimPlot+geom_hline(yintercept=0.5,linetype="dashed")
SplineFit
SplineSELECT
#Define the bootstrap prediction function
CLseq=5:23 #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names,k=5) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
#Define the bootstrap prediction function
CLseq=5:23 #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names,k=6) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
#Define the bootstrap prediction function
CLseq=5:23 #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names,k=7 #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Define the bootstrap prediction function
CLseq=5:23 #Carapace lengths to use for predn
PrednFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names,k=7) #Using spline defaults
predict(SplineFit,newdata=data.frame(CL=CLseq),type="response") }
#Check that it works
predn=PrednFnc(Pairs.df,vNames,qNames)
#Plot predictions against observed proportions
Tots.df=Raw2Tots(Pairs.df,vNames,qNames) |>
transform(lgth=CL, y=nB/(nA+nB))
plot(y~CL,data=Tots.df,ylim=c(0,1),xlab="Carapace length (mm)",
ylab="Gear B catch share")
points(CLseq,predn,type="l")
abline(h=0.5,lty=3)
StatsFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Defaults
SplineStatistics(SplineFit,MLS=15) }
#Check that it works
ObsStats=StatsFnc(Pairs.df,vNames,qNames)
ObsStats
StatsFnc=function(data,var.names,q.names) {
SplineFit=SplineSELECT(data,var.names,q.names) #Defaults
SplineStatistics(SplineFit,MLS=15) }
#Check that it works
ObsStats=StatsFnc(Pairs.df,vNames,qNames)
ObsStats
PermStats=permSELECT(Pairs.df,vNames,qNames,StatsFnc,haul="Haul",nsim=nsim,
paired=T,verbose=F) #Use verbose=T to see progress
colnames(PermStats)=names(ObsStats) #To add column names to PermStats
Stat="LRT" #Likelihood ratio test for a length effect
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for a length effect is",pval,"\n")
Stat="EqualLRT" #LRT for equivalence, i.e., catch comparison=0.5 for all lengths
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for equivalence is",pval,"\n")
Stat="RatioPropnMLS" #Proportion of large fish in gear B compared to in gear A
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for equal propns of large fish is",pval,"\n")
nperm=999
PermStats=permSELECT(Pairs.df,vNames,qNames,StatsFnc,haul="Haul",nsim=nperm,
paired=T,verbose=F) #Use verbose=T to see progress
colnames(PermStats)=names(ObsStats) #To add column names to PermStats
Stat="LRT" #Likelihood ratio test for a length effect
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for a length effect is",pval,"\n")
Stat="EqualLRT" #LRT for equivalence, i.e., catch comparison=0.5 for all lengths
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for equivalence is",pval,"\n")
Stat="RatioPropnMLS" #Proportion of large fish in gear B compared to in gear A
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for equal propns of large fish is",pval,"\n")
nperm=999
PermStats=permSELECT(Pairs.df,vNames,qNames,StatsFnc,haul="Haul",nsim=nperm,
paired=T,verbose=F) #Use verbose=T to see progress
colnames(PermStats)=names(ObsStats) #To add column names to PermStats
Stat="LRT" #Likelihood ratio test for a length effect
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for a length effect is",pval,"\n")
Stat="EqualLRT" #LRT for equivalence, i.e., catch comparison=0.5 for all lengths
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for equivalence is",pval,"\n")
Stat="RatioPropnMLS" #Proportion of large fish in gear B compared to in gear A
cat("The observed",Stat,"is",ObsStats[Stat],"\n")
pval=permPval(ObsStats[Stat],PermStats[,Stat])
cat("The permutational p-value for equal propns of large fish is",pval,"\n")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.4,linetype="dashed")
#The new plot function to replace BootPlot
SimPlot=BootPlot2(BootPreds,CLseq,predn,Data=Tots.df,show.pointwise=T)
SimPlot+geom_hline(yintercept=0.45,linetype="dashed")
